<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miniscript Playground</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  </head>
  <body>
    
    
    <!-- Contenedor envoltorio -->
    <div class="main-wrapper">
      
      <!-- Contenido superior -->
      <div class="top-panel" aria-label="Cabecera">
        <div class="top-panel-inner">
          <a href="https://github.com/unlock-blocks/Miniscript" target="_blank" rel="noopener" aria-label="Repositorio de GitHub de Bitcoin Miniscript" title="Repositorio de GitHub de Bitcoin Miniscript">
            <img src="btcLogo.png" alt="Repositorio de GitHub de Bitcoin Miniscript" title="Repositorio de GitHub de Bitcoin Miniscript" class="top-panel-logo">
          </a>
          <h1 class="top-panel-title">Miniscript Playground</h1>
          <a href="https://unlock-blocks.github.io/Miniscript/" target="_blank" rel="noopener" class="top-panel-right" aria-label="Abrir Miniscript Playground en nueva pestaÃ±a" title="Abrir Miniscript Playground en nueva pestaÃ±a">ğŸ›</a>
        </div>
      </div>

      <div class="container">

        <!-- Columna izquierda: MenÃº de pÃ³lizas -->
        <div class="menu"  aria-label="MenÃº de pÃ³lizas, seleccione una pÃ³liza">
          <h2><span aria-hidden="true">ğŸ—‚ï¸</span> PÃ³lizas </h2>

          
          <div class="button-row">
            <button class="app-button" title="Herencia digital" aria-label="Herencia digital" onclick="activarPoliza(this, 'htmls/herencia.html')"><span aria-hidden="true">ğŸ§¬</span> Herencia digital </button>
          </div>
          <div class="button-row">
            <button class="app-button" title="Autocustodia programada" aria-label="Autocustodia programada" onclick="activarPoliza(this, 'htmls/autocustodia.html')"><span aria-hidden="true">ğŸ¤–</span> Autocustodia programada </button>
          </div>
          <div class="button-row">
            <button class="app-button" title="BÃ³veda de seguridad" aria-label="BÃ³veda de seguridad" onclick="activarPoliza(this, 'htmls/boveda.html')"><span aria-hidden="true">ğŸ¦</span> BÃ³veda de seguridad</button>
          </div>
          <!-- Contenedor para la descripciÃ³n de la pÃ³liza (el Ã¡rbol) -->
          <div id="policy-description" class="policy-description"></div>
        </div>
      
          <!-- Columna derecha: Contenido del proyecto -->
          <div class="content" aria-label="MenÃº principal de la pÃ³liza, interactÃºe con la pÃ³liza">
            <!-- El contenido de la pÃ³liza (botones, etc.) se cargarÃ¡ aquÃ­ -->
            <div id="policy-content"></div>
            <!-- La consola de salida ÃšNICA para todos los scripts va aquÃ­ -->
            <div id="output-console" class="output-console"></div>
          </div>

      </div>
    </div>

    <script>

      // FunciÃ³n de ayuda para eliminar el tabulado de un texto multilÃ­nea.
      function dedent(text) {
        const lines = text.split('\n');
        let firstLineIndex = -1;

        // Encontrar la primera lÃ­nea con contenido
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].trim() !== '') {
            firstLineIndex = i;
            break;
          }
        }

        // Si no hay contenido, devolver cadena vacÃ­a
        if (firstLineIndex === -1) return '';

        // Calcular la indentaciÃ³n de la primera lÃ­nea con contenido
        const indentMatch = lines[firstLineIndex].match(/^\s*/);
        const indent = indentMatch ? indentMatch[0] : '';

        // Eliminar la indentaciÃ³n de todas las lÃ­neas y reconstruir el texto
        return lines.map(line => line.startsWith(indent) ? line.substring(indent.length) : line).join('\n').trim();
      }

      // FunciÃ³n para activar el botÃ³n del menÃº y cargar la pÃ³liza correspondiente
      function activarPoliza(button, url) {
        // Quitar la clase 'active' de todos los botones del menÃº
        document.querySelectorAll('.menu .app-button').forEach(btn => btn.classList.remove('active'));
        // AÃ±adir la clase 'active' al botÃ³n pulsado
        button.classList.add('active');
        // Forzar la recarga de la pÃ³liza aunque sea la misma
        loadProjectByURL(url);
      }

      // Variable global para almacenar el proyecto actual cargado y evitar recargas innecesarias
      let proyectoActual = null;

      // FunciÃ³n para cargar el contenido de la pÃ³liza seleccionada
      function loadProjectByURL(proyectoUrl) {
        const scriptName = proyectoUrl.split('/').pop().split('.')[0];
        // Si ya estÃ¡ cargada la misma pÃ³liza, no recargar
        if (proyectoActual === scriptName) return;
        proyectoActual = scriptName;

        // Limpiar la consola de salida al cambiar de pÃ³liza
        document.getElementById('output-console').innerHTML = '';

        // Cargar el contenido HTML de la pÃ³liza seleccionada 
        fetch(proyectoUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error('Error al cargar el contenido: ' + response.statusText);
            }
            return response.text();
          })
          .then(html => {
            // Insertar el contenido en el div de la derecha
            document.getElementById('policy-content').innerHTML = html;

            // Eliminar el script de la pÃ³liza cargada anteriormente para evitar conflictos.
            const oldScript = document.querySelector('script[data-policy-script]');
            if (oldScript) {
              oldScript.remove();
            }

            // Crear y aÃ±adir el nuevo script para la pÃ³liza actual.
            const script = document.createElement('script');
            // Se aÃ±ade un timestamp para forzar al navegador a re-ejecutar el script siempre.
            script.src = `./dist/${scriptName}.bundle.js?v=${new Date().getTime()}`;
            // Se aÃ±ade un atributo para poder encontrarlo y borrarlo la prÃ³xima vez.
            script.setAttribute('data-policy-script', 'true');
            document.body.appendChild(script);


            // Mostrar el Ã¡rbol de emojis segÃºn la pÃ³liza seleccionada
            if (scriptName === 'autocustodia') {
              document.getElementById('policy-description').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de Autocustodia Programada. Uso diario con 2 de 3 llaves. RecuperaciÃ³n a 3 meses con 1 de 2 llaves de respaldo. Emergencia a 5 meses con la llave de apertura por pÃ©rdida.</div>
                <pre aria-hidden="true"><span><span style="font-size:1.5em;" aria-hidden="true">ğŸ¤–</span><span style="font-size:1.2em;"><b> Autocustodia programada </b></span></span>
                â”‚    
                â”‚
                â”œâ”€ <span aria-hidden="true">ğŸ—“ï¸</span> <b>Uso diario: <span aria-hidden="true">ğŸ”‘ğŸ”‘ â¡ï¸ ğŸ”ğŸ”ğŸ”</span> </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ <span aria-hidden="true">ğŸ”‘</span> Llave principal 
                â”‚  â”‚ 
                â”‚  â”œâ”€ <span aria-hidden="true">ğŸ”‘</span> Llave secundaria
                â”‚  â”‚ 
                â”‚  â””â”€ <span aria-hidden="true">ğŸ—ï¸</span> Llave del custodio
                â”‚    
                â”‚    
                â”œâ”€ <span aria-hidden="true">ğŸ›¡ï¸</span><b> RecuperaciÃ³n <span aria-hidden="true">ğŸ•’</span> <label for="blocks-recovery-autocustodia" style="display:inline-flex;align-items:center;gap:6px;"> <input type="number" id="blocks-recovery-autocustodia" min="1" value="3" aria-label="NÃºmero de bloques para RecuperaciÃ³n" style="width:2.2rem;padding:2px;"/> bloques</label>: <span aria-hidden="true">ğŸ”‘ â¡ï¸ ğŸ”ğŸ”</span> </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ <span aria-hidden="true">ğŸ”‘</span> Llave de respaldo principal
                â”‚  â”‚ 
                â”‚  â””â”€ <span aria-hidden="true">ğŸ”‘</span> Llave de respaldo secundaria
                â”‚    
                â””â”€ <span aria-hidden="true">ğŸš¨</span><b> Emergencia <span aria-hidden="true">â°</span> <label for="blocks-emergency-autocustodia" style="display:inline-flex;align-items:center;gap:6px;"> <input type="number" id="blocks-emergency-autocustodia" min="1" value="5" aria-label="NÃºmero de bloques para Emergencia" style="width:2.2rem;padding:2px;"/> bloques</label>: <span aria-hidden="true">ğŸ—ï¸ â¡ï¸ ğŸ”</span> </b>
                   â”‚
                   â””â”€ <span aria-hidden="true">ğŸ—ï¸</span> Llave de apertura por perdida
                </pre>`);
            } else if (scriptName === 'boveda') { 
              document.getElementById('policy-description').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de BÃ³veda de Seguridad. Apertura forzada en 72 horas con la llave de apertura retardada. BotÃ³n del pÃ¡nico con la llave de apertura inmediata.</div>
                <pre aria-hidden="true"><span><span style="font-size:1.5em;" aria-hidden="true">ğŸ¦</span><span style="font-size:1.2em;"><b> BÃ³veda de seguridad </b></span></span>
                â”‚
                â”‚
                â”œâ”€ <span aria-hidden="true">ğŸ”§</span> <b>Apertura forzada <span aria-hidden="true">ğŸ•’</span> <label for="blocks-retardada" style="display:inline-flex;align-items:center;gap:6px;"> <input type="number" id="blocks-retardada" min="1" value="3" aria-label="NÃºmero de bloques para Apertura retardada" style="width:2.2rem;padding:2px;"/> bloques</label>: <span aria-hidden="true">ğŸ”‘ â¡ï¸ ğŸ”</span> </b>
                â”‚  â”‚ 
                â”‚  â””â”€ <span aria-hidden="true">ğŸ”‘</span> Llave de apertura retardada
                â”‚
                â”‚
                â””â”€ <span aria-hidden="true">ğŸ†˜</span> <b>BotÃ³n del pÃ¡nico: <span aria-hidden="true">ğŸ—ï¸ â¡ï¸ ğŸ”</span> </b>
                   â”‚
                   â””â”€ <span aria-hidden="true">ğŸ—ï¸</span> Llave de apertura inmediata
                </pre>`);
            } else if (scriptName === 'herencia') {
              document.getElementById('policy-description').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de Herencia Digital. Acceso directo con la llave del progenitor. Herencia con un nÃºmero de bloques configurable y Disputa con otro nÃºmero configurable.</div>
                <pre aria-hidden="true"><span><span style="font-size:1.5em;" aria-hidden="true">ğŸ§¬</span><span style="font-size:1.2em;"><b> Herencia digital </b></span></span>
                â”‚
                â”‚
                â”œâ”€ <span aria-hidden="true">ğŸ§“ğŸ»</span> <b>Acceso directo: <span aria-hidden="true">ğŸ”‘ â¡ï¸ ğŸ”</span> </b>
                â”‚  â”‚ 
                â”‚  â””â”€ <span aria-hidden="true">ğŸ”‘</span> Llave del progenitor
                â”‚
                â”‚
                â”œâ”€ <span aria-hidden="true">ğŸ§‘ğŸ»ğŸ‘¨ğŸ»</span> <b>Herencia <span aria-hidden="true">ğŸ•’</span> <label for="blocks-herencia" style="display:inline-flex;align-items:center;gap:6px;"> <input type="number" id="blocks-herencia" min="1" value="3" aria-label="NÃºmero de bloques para Herencia" style="width:2.2rem;padding:2px;"/> bloques</label>: <span aria-hidden="true">ğŸ”‘ğŸ”‘ â¡ï¸ ğŸ”ğŸ”</span> </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ <span aria-hidden="true">ğŸ”‘</span> Llave de la heredera
                â”‚  â”‚ 
                â”‚  â””â”€ <span aria-hidden="true">ğŸ”‘</span> Llave del heredero
                â”‚
                â”‚
                â””â”€ <span aria-hidden="true">ğŸ‘¤</span> <b>Disputa <span aria-hidden="true">â°</span> <label for="blocks-disputa" style="display:inline-flex;align-items:center;gap:6px;"> <input type="number" id="blocks-disputa" min="1" value="5" aria-label="NÃºmero de bloques para Disputa" style="width:2.2rem;padding:2px;"/> bloques</label>: <span aria-hidden="true">ğŸ—ï¸ â¡ï¸ ğŸ”</span> </b>
                   â”‚ 
                   â””â”€ <span aria-hidden="true">ğŸ—ï¸</span> Llave del abogado
                </pre>`);
            } else {
              document.getElementById('policy-description').innerHTML = '';
            }
          })

          .catch(error => {
            console.error('Error:', error);
            document.getElementById('content').innerHTML = `<p>Error al cargar el proyecto: ${error.message}</p>`;
          });
      }

      // Autocargar la primera pÃ³liza al iniciar la pÃ¡gina
      document.addEventListener('DOMContentLoaded', () => {
        const firstButton = document.querySelector('.menu .app-button');
        if (firstButton) {
          activarPoliza(firstButton, 'htmls/herencia.html');
        }
      });
    </script>

  </body>
</html>